<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordle Solver</title>
    <style>
        :root {
            --green: #6aaa64;
            --green-dark: #538d4e;
            --yellow: #c9b458;
            --yellow-dark: #b59f3b;
            --gray: #787c7e;
            --gray-light: #d3d6da;
            --black: #121213;
            --white: #ffffff;
            --bg-light: #ffffff;
            --bg-dark: #121213;
            --text-light: #121213;
            --text-dark: #f8f8f8;
            --border-light: #d3d6da;
            --border-dark: #3a3a3c;
            --input-bg-light: #ffffff;
            --input-bg-dark: #3a3a3c;
            --card-bg-light: #ffffff;
            --card-bg-dark: #1a1a1b;
            --hover-light: #f6f7f8;
            --hover-dark: #2f2f31;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: "Clear Sans", "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-light);
            min-height: 100vh;
            padding: 1rem;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body.dark {
            background-color: var(--bg-dark);
            color: var(--text-dark);
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 1rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-light);
        }

        body.dark .header {
            border-bottom-color: var(--border-dark);
        }
        
        h1 {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 0.01em;
            color: var(--text-light);
        }

        body.dark h1 {
            color: var(--text-dark);
        }

        .header-buttons {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .theme-toggle, .help-toggle {
            background: none;
            border: 1px solid var(--border-light);
            border-radius: 4px;
            padding: 0.5rem;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            color: var(--text-light);
        }

        body.dark .theme-toggle, body.dark .help-toggle {
            border-color: var(--border-dark);
            color: var(--text-dark);
        }

        .theme-toggle:hover, .help-toggle:hover {
            background: var(--hover-light);
        }

        body.dark .theme-toggle:hover, body.dark .help-toggle:hover {
            background: var(--hover-dark);
        }

        .theme-toggle svg, .help-toggle svg {
            width: 20px;
            height: 20px;
            fill: none;
            stroke: currentColor;
        }
        
        .input-section {
            margin-bottom: 2rem;
        }
        
        .word-input-group {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .letter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: center;
        }
        
        .letter-input {
            width: 50px;
            height: 50px;
            padding: 0;
            font-size: 1.5rem;
            border: 2px solid var(--border-light);
            border-radius: 4px;
            text-transform: uppercase;
            font-family: "Clear Sans", "Helvetica Neue", Arial, sans-serif;
            font-weight: 700;
            text-align: center;
            background: var(--input-bg-light);
            color: var(--text-light);
            transition: all 0.2s;
        }

        body.dark .letter-input {
            border-color: var(--border-dark);
            background: var(--input-bg-dark);
            color: var(--text-dark);
        }
        
        .letter-input:focus {
            outline: none;
            border-color: var(--green);
        }

        body.dark .letter-input:focus {
            border-color: var(--green-dark);
        }
        
        .feedback-input {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .feedback-btn {
            width: 50px;
            height: 50px;
            font-size: 1.25rem;
            font-weight: 700;
            border: 2px solid var(--border-light);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
            background: var(--input-bg-light);
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        body.dark .feedback-btn {
            border-color: var(--border-dark);
            background: var(--input-bg-dark);
            color: var(--text-dark);
        }
        
        .feedback-btn.green {
            background: var(--green);
            color: var(--white);
            border-color: var(--green);
        }

        body.dark .feedback-btn.green {
            background: var(--green-dark);
            border-color: var(--green-dark);
        }
        
        .feedback-btn.yellow {
            background: var(--yellow);
            color: var(--white);
            border-color: var(--yellow);
        }

        body.dark .feedback-btn.yellow {
            background: var(--yellow-dark);
            border-color: var(--yellow-dark);
        }
        
        .feedback-btn.gray {
            background: var(--gray);
            color: var(--white);
            border-color: var(--gray);
        }
        
        .feedback-btn:not(.green):not(.yellow):not(.gray):hover {
            background: var(--hover-light);
        }

        body.dark .feedback-btn:not(.green):not(.yellow):not(.gray):hover {
            background: var(--hover-dark);
        }
        
        .add-btn {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 700;
            background: var(--green);
            color: var(--white);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
            letter-spacing: 0.05em;
        }

        body.dark .add-btn {
            background: var(--green-dark);
        }
        
        .add-btn:hover {
            background: var(--green-dark);
        }

        body.dark .add-btn:hover {
            background: var(--green);
        }
        
        .add-btn:disabled {
            background: var(--gray-light);
            cursor: not-allowed;
        }

        body.dark .add-btn:disabled {
            background: var(--border-dark);
        }
        
        .reset-btn {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 700;
            background: transparent;
            color: var(--text-light);
            border: 1px solid var(--border-light);
            border-radius: 4px;
            cursor: pointer;
            margin-left: 0.5rem;
            transition: all 0.2s;
            letter-spacing: 0.05em;
        }

        body.dark .reset-btn {
            color: var(--text-dark);
            border-color: var(--border-dark);
        }
        
        .reset-btn:hover {
            background: var(--hover-light);
        }

        body.dark .reset-btn:hover {
            background: var(--hover-dark);
        }
        
        .attempts {
            margin-top: 2rem;
        }

        .attempts h3 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-light);
        }

        body.dark .attempts h3 {
            color: var(--text-dark);
        }
        
        .attempt {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--card-bg-light);
            border: 1px solid var(--border-light);
            border-radius: 4px;
            margin-bottom: 0.5rem;
            transition: all 0.2s;
        }

        body.dark .attempt {
            background: var(--card-bg-dark);
            border-color: var(--border-dark);
        }
        
        .attempt-word {
            font-family: "Clear Sans", "Helvetica Neue", Arial, sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            color: var(--text-light);
        }

        body.dark .attempt-word {
            color: var(--text-dark);
        }
        
        .attempt-feedback {
            display: flex;
            gap: 0.3rem;
        }
        
        .feedback-dot {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: inline-block;
        }
        
        .feedback-dot.green {
            background: var(--green);
        }

        body.dark .feedback-dot.green {
            background: var(--green-dark);
        }
        
        .feedback-dot.yellow {
            background: var(--yellow);
        }

        body.dark .feedback-dot.yellow {
            background: var(--yellow-dark);
        }
        
        .feedback-dot.gray {
            background: var(--gray);
        }
        
        .words-section {
            margin-top: 2rem;
        }
        
        .words-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .words-header h2 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-light);
        }

        body.dark .words-header h2 {
            color: var(--text-dark);
        }
        
        .word-count {
            font-size: 0.875rem;
            color: var(--gray);
            font-weight: 600;
        }
        
        .words-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.5rem;
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            background: var(--card-bg-light);
            border: 1px solid var(--border-light);
            border-radius: 4px;
        }

        body.dark .words-grid {
            background: var(--card-bg-dark);
            border-color: var(--border-dark);
        }
        
        .word-item {
            padding: 0.75rem 0.5rem;
            background: var(--input-bg-light);
            border: 1px solid var(--border-light);
            border-radius: 4px;
            text-align: center;
            font-family: "Clear Sans", "Helvetica Neue", Arial, sans-serif;
            font-weight: 700;
            font-size: 0.875rem;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.15s;
            color: var(--text-light);
        }

        body.dark .word-item {
            background: var(--input-bg-dark);
            border-color: var(--border-dark);
            color: var(--text-dark);
        }
        
        .word-item:hover {
            background: var(--green);
            color: var(--white);
            border-color: var(--green);
            transform: scale(1.05);
        }

        body.dark .word-item:hover {
            background: var(--green-dark);
            border-color: var(--green-dark);
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
        }

        body.dark .loading {
            color: var(--gray-light);
        }
        
        .instructions {
            background: var(--hover-light);
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            line-height: 1.6;
            color: var(--text-light);
            border: 1px solid var(--border-light);
            display: none;
        }

        .instructions.show {
            display: block;
        }

        body.dark .instructions {
            background: var(--hover-dark);
            border-color: var(--border-dark);
            color: var(--text-dark);
        }
        
        .instructions strong {
            font-weight: 700;
        }

        .instructions .color-gray {
            color: var(--gray);
        }

        .instructions .color-green {
            color: var(--green);
        }

        body.dark .instructions .color-green {
            color: var(--green-dark);
        }

        .instructions .color-yellow {
            color: var(--yellow);
        }

        body.dark .instructions .color-yellow {
            color: var(--yellow-dark);
        }

        /* Scrollbar styling */
        .words-grid::-webkit-scrollbar {
            width: 8px;
        }

        .words-grid::-webkit-scrollbar-track {
            background: var(--hover-light);
            border-radius: 4px;
        }

        body.dark .words-grid::-webkit-scrollbar-track {
            background: var(--hover-dark);
        }

        .words-grid::-webkit-scrollbar-thumb {
            background: var(--gray-light);
            border-radius: 4px;
        }

        body.dark .words-grid::-webkit-scrollbar-thumb {
            background: var(--border-dark);
        }

        .words-grid::-webkit-scrollbar-thumb:hover {
            background: var(--gray);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>WORDLE SOLVER</h1>
            <div class="header-buttons">
                <button class="help-toggle" id="helpToggle" onclick="toggleInstructions()" aria-label="Show help">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                </button>
                <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" aria-label="Toggle theme">
                    <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        
        <div class="instructions" id="instructions">
            <strong>How to use:</strong> Enter a 5-letter word you tried in Wordle, then click the feedback buttons for each letter to cycle through:
            <strong class="color-gray">Gray</strong> (default) = letter is not in the word, 
            <strong class="color-yellow">Yellow</strong> = letter is in the word but wrong position, 
            <strong class="color-green">Green</strong> = correct letter in correct position. Click "Add Attempt" to filter the word list.
        </div>
        
        <div class="input-section">
            <div class="word-input-group" id="wordInputGroup"></div>
            <div style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 1rem;">
                <button class="add-btn" id="addBtn" onclick="addAttempt()">Add Attempt</button>
                <button class="reset-btn" id="resetBtn" onclick="resetSolver()">Reset</button>
            </div>
        </div>
        
        <div class="attempts" id="attempts"></div>
        
        <div class="words-section">
            <div class="words-header">
                <h2>Possible Words</h2>
                <div class="word-count" id="wordCount">Loading...</div>
            </div>
            <div class="words-grid" id="wordsGrid">
                <div class="loading">Loading words...</div>
            </div>
        </div>
    </div>

    <script>
        let allWords = [];
        let filteredWords = [];
        let attempts = [];

        // Theme management
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark');
            } else {
                document.body.classList.remove('dark');
            }
            updateThemeIcon(savedTheme === 'dark');
        }

        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcon(isDark);
        }

        function updateThemeIcon(isDark) {
            const themeIcon = document.getElementById('themeIcon');
            if (isDark) {
                // Moon icon for dark mode
                themeIcon.innerHTML = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>';
            } else {
                // Sun icon for light mode
                themeIcon.innerHTML = '<circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>';
            }
        }

        function toggleInstructions() {
            const instructions = document.getElementById('instructions');
            instructions.classList.toggle('show');
        }

        // Load words from file
        async function loadWords() {
            try {
                const wordsGrid = document.getElementById('wordsGrid');
                wordsGrid.innerHTML = '<div class="loading">Loading words...</div>';
                
                const response = await fetch('fiveltr.txt');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const text = await response.text();
                allWords = text.trim().split('\n').map(word => word.trim().toLowerCase()).filter(word => word.length === 5);
                
                if (allWords.length === 0) {
                    throw new Error('No valid words found in file');
                }
                
                filteredWords = [...allWords];
                console.log(`Loaded ${allWords.length} words`);
                
                updateWordDisplay();
                setupFeedbackButtons();
            } catch (error) {
                console.error('Error loading words:', error);
                const wordsGrid = document.getElementById('wordsGrid');
                wordsGrid.innerHTML = `<div class="loading">Error loading words file: ${error.message}</div>`;
            }
        }

        // Setup letter inputs and feedback buttons
        function setupFeedbackButtons() {
            const wordInputGroup = document.getElementById('wordInputGroup');
            wordInputGroup.innerHTML = '';
            
            for (let i = 0; i < 5; i++) {
                const letterGroup = document.createElement('div');
                letterGroup.className = 'letter-group';
                
                // Create letter input
                const letterInput = document.createElement('input');
                letterInput.type = 'text';
                letterInput.className = 'letter-input';
                letterInput.id = `letterInput${i}`;
                letterInput.maxLength = 1;
                letterInput.autocomplete = 'off';
                letterInput.dataset.index = i;
                
                // Auto-advance to next input on letter entry and auto-fill feedback
                letterInput.addEventListener('input', (e) => {
                    const previousValue = e.target.value;
                    e.target.value = e.target.value.toUpperCase().replace(/[^A-Z]/g, '');
                    
                    const feedbackBtn = document.querySelector(`.feedback-btn[data-index="${i}"]`);
                    
                    // If letter was deleted (empty after processing), reset feedback button to gray
                    if (!e.target.value) {
                        if (feedbackBtn) {
                            setFeedbackButton(feedbackBtn, 'gray');
                        }
                    } else {
                        // Letter exists, auto-fill feedback based on previous attempts
                        if (feedbackBtn) {
                            autoFillFeedback();
                        }
                    }
                    
                    if (e.target.value && i < 4) {
                        document.getElementById(`letterInput${i + 1}`).focus();
                    }
                });
                
                // Handle backspace to go to previous input
                letterInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Backspace' && !e.target.value && i > 0) {
                        document.getElementById(`letterInput${i - 1}`).focus();
                    }
                });
                
                // Create feedback button
                const feedbackBtn = document.createElement('button');
                feedbackBtn.className = 'feedback-btn gray';
                feedbackBtn.textContent = '✗';
                feedbackBtn.dataset.index = i;
                feedbackBtn.onclick = () => toggleFeedback(feedbackBtn);
                
                letterGroup.appendChild(letterInput);
                letterGroup.appendChild(feedbackBtn);
                wordInputGroup.appendChild(letterGroup);
            }
        }

        // Auto-fill feedback based on previous attempts
        function autoFillFeedback() {
            if (attempts.length === 0) return;
            
            // Get current word being typed
            const currentWord = [];
            for (let i = 0; i < 5; i++) {
                const letterInput = document.getElementById(`letterInput${i}`);
                if (letterInput) {
                    currentWord[i] = letterInput.value.toUpperCase();
                }
            }
            
            // For each position, check previous attempts
            for (let pos = 0; pos < 5; pos++) {
                const currentLetter = currentWord[pos];
                if (!currentLetter) continue;
                
                const feedbackBtn = document.querySelector(`.feedback-btn[data-index="${pos}"]`);
                if (!feedbackBtn) continue;
                
                // Get current state - only auto-fill if it's still gray (default)
                const currentState = feedbackBtn.className.includes('green') ? 'green' : 
                                      feedbackBtn.className.includes('yellow') ? 'yellow' : 'gray';
                
                // Only auto-fill if button is still in default gray state
                if (currentState !== 'gray') continue;
                
                let autoFillState = null;
                
                // Check all previous attempts
                for (const attempt of attempts) {
                    const attemptWord = attempt.word.toUpperCase().split('');
                    const attemptFeedback = attempt.feedback;
                    
                    // Rule 1: If this exact position had green feedback for the same letter, auto-fill green
                    if (attemptFeedback[pos] === 'green' && attemptWord[pos] === currentLetter) {
                        autoFillState = 'green';
                        break; // Green takes highest priority
                    }
                    
                    // Rule 2: If this letter was gray (not in word) in any previous attempt, keep it gray
                    let letterWasGray = false;
                    let letterWasInWord = false;
                    for (let prevPos = 0; prevPos < 5; prevPos++) {
                        if (attemptWord[prevPos] === currentLetter) {
                            if (attemptFeedback[prevPos] === 'gray') {
                                letterWasGray = true;
                            } else if (attemptFeedback[prevPos] === 'green' || attemptFeedback[prevPos] === 'yellow') {
                                letterWasInWord = true;
                                break;
                            }
                        }
                    }
                    
                    if (letterWasGray && !letterWasInWord && autoFillState === null) {
                        autoFillState = 'gray';
                        break;
                    }
                }
                
                // Apply auto-fill if we determined a state
                if (autoFillState !== null) {
                    setFeedbackButton(feedbackBtn, autoFillState);
                }
            }
        }
        
        // Helper function to set feedback button state
        function setFeedbackButton(btn, state) {
            btn.className = 'feedback-btn';
            btn.classList.add(state);
            btn.textContent = state === 'green' ? '✓' : state === 'yellow' ? '~' : '✗';
        }

        // Toggle feedback button state
        function toggleFeedback(btn) {
            const states = ['gray', 'yellow', 'green'];
            const currentState = btn.className.includes('green') ? 'green' : 
                                btn.className.includes('yellow') ? 'yellow' : 'gray';
            const currentIndex = states.indexOf(currentState);
            const nextIndex = (currentIndex + 1) % states.length;
            const nextState = states[nextIndex];
            
            setFeedbackButton(btn, nextState);
        }

        // Add attempt and filter words
        function addAttempt() {
            // Collect letters from individual inputs
            let word = '';
            for (let i = 0; i < 5; i++) {
                const letterInput = document.getElementById(`letterInput${i}`);
                const letter = letterInput.value.trim().toUpperCase();
                if (!letter) {
                    alert('Please enter all 5 letters');
                    return;
                }
                word += letter;
            }
            word = word.toLowerCase();
            
            const feedback = [];
            const feedbackBtns = document.querySelectorAll('.feedback-btn');
            
            for (let i = 0; i < 5; i++) {
                const btn = feedbackBtns[i];
                let state = 'gray'; // Default to gray
                if (btn.classList.contains('green')) state = 'green';
                else if (btn.classList.contains('yellow')) state = 'yellow';
                else if (btn.classList.contains('gray')) state = 'gray';
                
                feedback.push(state);
            }
            
            attempts.push({ word, feedback });
            displayAttempts();
            filterWords();
            
            // Clear inputs
            setupFeedbackButtons();
            document.getElementById('letterInput0').focus();
        }

        // Display attempts
        function displayAttempts() {
            const attemptsDiv = document.getElementById('attempts');
            if (attempts.length === 0) {
                attemptsDiv.innerHTML = '';
                return;
            }
            
            attemptsDiv.innerHTML = '<h3>Your Attempts:</h3>';
            attempts.forEach((attempt, idx) => {
                const attemptDiv = document.createElement('div');
                attemptDiv.className = 'attempt';
                
                const wordSpan = document.createElement('span');
                wordSpan.className = 'attempt-word';
                wordSpan.textContent = attempt.word.toUpperCase();
                
                const feedbackDiv = document.createElement('div');
                feedbackDiv.className = 'attempt-feedback';
                
                attempt.feedback.forEach(state => {
                    const dot = document.createElement('span');
                    dot.className = `feedback-dot ${state}`;
                    feedbackDiv.appendChild(dot);
                });
                
                attemptDiv.appendChild(wordSpan);
                attemptDiv.appendChild(feedbackDiv);
                attemptsDiv.appendChild(attemptDiv);
            });
        }

        // Filter words based on attempts
        function filterWords() {
            // Clear cache when filtering changes
            cachedFrequencies = null;
            cachedFilteredWordsLength = 0;
            
            filteredWords = allWords.filter(word => {
                return attempts.every(attempt => matchesAttempt(word, attempt));
            });
            updateWordDisplay();
        }

        // Check if word matches an attempt
        function matchesAttempt(word, attempt) {
            const wordLetters = word.split('');
            const attemptWord = attempt.word.split('');
            const feedback = attempt.feedback;
            
            // Check green (correct position)
            for (let i = 0; i < 5; i++) {
                if (feedback[i] === 'green') {
                    if (wordLetters[i] !== attemptWord[i]) {
                        return false;
                    }
                }
            }
            
            // Check gray (not in word)
            for (let i = 0; i < 5; i++) {
                if (feedback[i] === 'gray') {
                    const letter = attemptWord[i];
                    // Count how many times this letter appears in the attempt word
                    const countInAttempt = attemptWord.filter(l => l === letter).length;
                    // Count how many times it appears in feedback (green or yellow)
                    const countInFeedback = feedback.filter((f, idx) => 
                        (f === 'green' || f === 'yellow') && attemptWord[idx] === letter
                    ).length;
                    
                    // If all instances of this letter are gray, the letter shouldn't be in the word at all
                    if (countInAttempt === countInFeedback) {
                        if (wordLetters.includes(letter)) {
                            return false;
                        }
                    } else {
                        // Some instances are green/yellow, so we can only say this specific position doesn't have it
                        // But we need to be careful - if this is the only gray instance, the letter might still be in the word
                        // For simplicity, we'll check if the letter appears more times than allowed
                        const countInWord = wordLetters.filter(l => l === letter).length;
                        if (countInWord >= countInFeedback) {
                            // This is okay, but we still need to check this specific position
                            if (wordLetters[i] === letter) {
                                return false;
                            }
                        }
                    }
                }
            }
            
            // Check yellow (in word but wrong position)
            for (let i = 0; i < 5; i++) {
                if (feedback[i] === 'yellow') {
                    const letter = attemptWord[i];
                    // Letter must be in the word
                    if (!wordLetters.includes(letter)) {
                        return false;
                    }
                    // But not in this position
                    if (wordLetters[i] === letter) {
                        return false;
                    }
                    
                    // Count how many times this letter appears in green/yellow feedback
                    const countInFeedback = feedback.filter((f, idx) => 
                        (f === 'green' || f === 'yellow') && attemptWord[idx] === letter
                    ).length;
                    
                    // The word must have at least this many instances of the letter
                    const countInWord = wordLetters.filter(l => l === letter).length;
                    if (countInWord < countInFeedback) {
                        return false;
                    }
                }
            }
            
            return true;
        }

        // Pre-calculate letter frequencies (optimization - do this once)
        let cachedFrequencies = null;
        let cachedFilteredWordsLength = 0;
        
        function calculateFrequencies() {
            if (filteredWords.length === 0) {
                cachedFrequencies = { letterFreq: {}, positionFreq: [{}, {}, {}, {}, {}] };
                return;
            }
            
            // Only recalculate if the filtered list changed
            if (cachedFrequencies && cachedFilteredWordsLength === filteredWords.length) {
                return;
            }
            
            const letterFreq = {};
            const positionFreq = [{}, {}, {}, {}, {}];
            
            filteredWords.forEach(possibleWord => {
                const letters = possibleWord.split('');
                letters.forEach((letter, pos) => {
                    letterFreq[letter] = (letterFreq[letter] || 0) + 1;
                    if (!positionFreq[pos][letter]) {
                        positionFreq[pos][letter] = 0;
                    }
                    positionFreq[pos][letter]++;
                });
            });
            
            cachedFrequencies = { letterFreq, positionFreq };
            cachedFilteredWordsLength = filteredWords.length;
        }
        
        // Calculate word score based on information gain potential (optimized)
        function calculateWordScore(word, letterFreq, positionFreq, totalWords) {
            if (totalWords === 0) return 0;
            
            const wordLetters = word.split('');
            let score = 0;
            
            // Score based on letter frequency (common letters = more informative)
            const uniqueLetters = new Set(wordLetters);
            wordLetters.forEach((letter, pos) => {
                // Position-specific score (higher if letter is common in this position)
                const posScore = (positionFreq[pos][letter] || 0) / totalWords;
                score += posScore * 2; // Weight position matches more
                
                // Overall letter frequency score
                const letterScore = (letterFreq[letter] || 0) / totalWords;
                score += letterScore;
            });
            
            // Bonus for words with unique letters (no duplicates)
            if (uniqueLetters.size === 5) {
                score *= 1.2;
            } else if (uniqueLetters.size === 4) {
                score *= 1.1;
            } else if (uniqueLetters.size <= 2) {
                score *= 0.8;
            }
            
            return score;
        }
        
        // Update word display with progress indication
        function updateWordDisplay() {
            const wordsGrid = document.getElementById('wordsGrid');
            const wordCount = document.getElementById('wordCount');
            
            wordCount.textContent = `${filteredWords.length} possible word${filteredWords.length !== 1 ? 's' : ''}`;
            
            if (filteredWords.length === 0) {
                wordsGrid.innerHTML = '<div class="loading">No words match your criteria</div>';
                return;
            }
            
            // Show loading while calculating
            wordsGrid.innerHTML = '<div class="loading">Calculating best guesses...</div>';
            
            // Use setTimeout to allow UI to update before heavy computation
            setTimeout(() => {
                try {
                    // Pre-calculate frequencies once
                    calculateFrequencies();
                    const { letterFreq, positionFreq } = cachedFrequencies;
                    const totalWords = filteredWords.length;
                    
                    // Calculate scores for all words (optimized - frequencies pre-calculated)
                    const wordsWithScores = filteredWords.map(word => ({
                        word,
                        score: calculateWordScore(word, letterFreq, positionFreq, totalWords)
                    }));
                    
                    // Sort by score (all words, no limit)
                    wordsWithScores.sort((a, b) => b.score - a.score);
                    
                    // Display sorted words
                    wordsGrid.innerHTML = '';
                    wordsWithScores.forEach(({ word }) => {
                        const wordDiv = document.createElement('div');
                        wordDiv.className = 'word-item';
                        wordDiv.textContent = word.toUpperCase();
                        wordDiv.onclick = () => {
                            const letters = word.toUpperCase().split('');
                            for (let i = 0; i < 5; i++) {
                                const letterInput = document.getElementById(`letterInput${i}`);
                                if (letterInput) {
                                    letterInput.value = letters[i] || '';
                                }
                            }
                            // Auto-fill feedback after setting letters
                            autoFillFeedback();
                            document.getElementById('letterInput0').focus();
                        };
                        wordsGrid.appendChild(wordDiv);
                    });
                } catch (error) {
                    console.error('Error calculating word scores:', error);
                    wordsGrid.innerHTML = '<div class="loading">Error calculating scores. Showing alphabetical list.</div>';
                    // Fallback to unsorted display
                    setTimeout(() => {
                        wordsGrid.innerHTML = '';
                        filteredWords.slice(0, 500).forEach(word => {
                            const wordDiv = document.createElement('div');
                            wordDiv.className = 'word-item';
                            wordDiv.textContent = word.toUpperCase();
                            wordDiv.onclick = () => {
                                const letters = word.toUpperCase().split('');
                                for (let i = 0; i < 5; i++) {
                                    const letterInput = document.getElementById(`letterInput${i}`);
                                    if (letterInput) {
                                        letterInput.value = letters[i] || '';
                                    }
                                }
                                autoFillFeedback();
                                document.getElementById('letterInput0').focus();
                            };
                            wordsGrid.appendChild(wordDiv);
                        });
                    }, 100);
                }
            }, 10);
        }

        // Reset solver
        function resetSolver() {
            if (confirm('Are you sure you want to reset? This will clear all attempts.')) {
                attempts = [];
                filteredWords = [...allWords];
                displayAttempts();
                updateWordDisplay();
                setupFeedbackButtons();
                document.getElementById('letterInput0').focus();
            }
        }

        // Allow Enter key to add attempt from any letter input
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && e.target.classList.contains('letter-input')) {
                addAttempt();
            }
        });

        // Initialize theme and load words on page load
        initTheme();
        loadWords();
    </script>
</body>
</html>
